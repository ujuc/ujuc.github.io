<!DOCTYPE html>
<html lang="ko">

  <head>
    <!-- Meta -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="ujuc">
    
    <meta property="og:site_name" content="ì˜ ë°¤ì— ì“¸ë°ì—†ëŠ” ìƒê°í•˜ê¸°">
    <meta property="og:type" content="website">
    <meta property="inLanguage" content="ko-KR">

    <!-- Twitter Card data-->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="ì˜ ë°¤ì— ì“¸ë°ì—†ëŠ” ìƒê°í•˜ê¸°">

    <meta name="keyward" content="go,database,translate">
    <meta property="og:title" content="[ë²ˆì—­] Design of QL">
    <meta name="twitter:title" content="[ë²ˆì—­] Design of QL">
    <meta itemprop="name" content="[ë²ˆì—­] Design of QL">
    <meta name="description" content="Go ì„ë² ë””ë“œ ë°ì´í„°ë² ì´ìŠ¤ íŒ¨í‚¤ì§€ì¸ QLì— ëŒ€í•œ ë””ìì¸ ë¬¸ì„œì´ë‹¤.">
    <meta property="og:description" content="Go ì„ë² ë””ë“œ ë°ì´í„°ë² ì´ìŠ¤ íŒ¨í‚¤ì§€ì¸ QLì— ëŒ€í•œ ë””ìì¸ ë¬¸ì„œì´ë‹¤.">
    <meta name="twitter:description" content="Go ì„ë² ë””ë“œ ë°ì´í„°ë² ì´ìŠ¤ íŒ¨í‚¤ì§€ì¸ QLì— ëŒ€í•œ ë””ìì¸ ë¬¸ì„œì´ë‹¤.">
    <meta itemprop="description" content="Go ì„ë² ë””ë“œ ë°ì´í„°ë² ì´ìŠ¤ íŒ¨í‚¤ì§€ì¸ QLì— ëŒ€í•œ ë””ìì¸ ë¬¸ì„œì´ë‹¤.">
    <meta property="og:url" content="https://ujuc.github.io/2018/05/24/design_of_ql/">
    <meta property="article:published_time" content="2018-05-24T00:00:02+09:00">
    <meta property="article:modified_time" content="2018-03-23T16:50:00+09:00">
    <meta property="article:tag" content="go">
    <meta property="article:tag" content="database">
    <meta property="article:tag" content="translate">

    <!-- Title -->
    <title>
      ì˜ ë°¤ì— ì“¸ë°ì—†ëŠ” ìƒê°í•˜ê¸°/[ë²ˆì—­] Design of QL
    </title>

<!-- Style sheet -->
<!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/44208652df.js" crossorigin="anonymous"></script>

<!-- Style -->
<link rel="stylesheet" type="text/css" href="https://ujuc.github.io/theme/css/style.css">
<link rel="stylesheet" type="text/css" href="https://ujuc.github.io/theme/css/pygments.css">

<!-- Feed -->
<link href="https://ujuc.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ì˜ ë°¤ì— ì“¸ë°ì—†ëŠ” ìƒê°í•˜ê¸° ATOM" />
<link href="https://ujuc.github.io/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="ì˜ ë°¤ì— ì“¸ë°ì—†ëŠ” ìƒê°í•˜ê¸° RSS" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X9EBSXCBTS"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-X9EBSXCBTS');
</script>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1014314833699403",
    enable_page_level_ads: true
  });
</script>
  </head>

  <body>
    <header>
      <!-- navi -->
      <div class="container" style="margin-top: 10px;">
<ul class="nav">
    <li class="nav-item">
      <a class="nav-link" href="/">
        <em class="fa-solid fa-inbox"></em> Blog
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/archives.html">
        <em class="fa-solid fa-archive"></em> Archive
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/tags.html">
        <em class="fa-solid fa-tags"></em> Tags
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/categories.html">
        <em class="fa-solid fa-folder-open"></em> Categories
      </a>
    </li>
</ul>      </div>
    </header>

    <div id="site-article" class="container">
<div class="container">
  <div class="article">
  <!-- Title -->
    <div class="article-title">[ë²ˆì—­] Design of QL</div>

  <!-- Meta -->
    <div class="article-meta">
      <em class="fa-regular fa-calendar-plus"></em>
        18. 05. 24.
 / <em class="fa-solid fa-arrows-rotate"></em> 18. 03. 23.       <em class="fa-solid fa-ellipsis-vertical"></em>
      <em class="fa-solid fa-folder-open"></em>
        <a href="https://ujuc.github.io/category/develop.html">Develop</a>
      <em class="fa-solid fa-ellipsis-vertical"></em>
      <em class="fa-solid fa-tags"></em>
        <a href="https://ujuc.github.io/tag/go.html" class="article_tag">go</a>
,         <a href="https://ujuc.github.io/tag/database.html" class="article_tag">database</a>
,         <a href="https://ujuc.github.io/tag/translate.html" class="article_tag">translate</a>
    </div>

  <!--Article -->
    <div class="text-center"><em class="fa-solid fa-poo-storm"></em></div>
    <div class="article-text"><p><code>QL</code> design ë¬¸ì„œ</p>
<p>ì´ ë¬¸ì„œëŠ” <a href="https://github.com/cznic/ql"><code>cznic/ql</code></a> í”„ë¡œì íŠ¸ ì„¤ê³„ ë¬¸ì„œì´ë‹¤.<br>
<code>QL</code> ì€ Goë¡œ ë§Œë“¤ì–´ì§„ embedded SQL ë°ì´í„°ë² ì´ìŠ¤ì´ë‹¤.</p>
<p><strong>ì›ë¬¸</strong></p>
<ul>
<li>code: <a href="https://github.com/cznic/ql/blob/v1.1.0/design/doc.go">doc.go - v1.1.0</a></li>
<li>godoc: <a href="https://godoc.org/github.com/cznic/ql/design">package design</a></li>
</ul>
<hr>
<div class="toc">
<ul>
<li><a href="#handles">Handles</a></li>
<li><a href="#scalar-encoding">Scalar encoding</a></li>
<li><a href="#database-root">Database root</a></li>
<li><a href="#table-meta-data">Table meta data</a></li>
<li><a href="#indices">Indices</a></li>
<li><a href="#table-record">Table record</a></li>
<li><a href="#non-unique-index">Non unique index</a></li>
<li><a href="#unique-index">Unique index</a></li>
<li><a href="#non-scalar-types">Non scalar types</a></li>
<li><a href="#blob-encoding">Blob encoding</a></li>
<li><a href="#links">Links</a></li>
<li><a href="#rationale">Rationale</a></li>
</ul>
</div>
<p>íŒ¨í‚¤ì§€ ë””ìì¸ì€ QLì—ì„œ ì‚¬ìš©ì¤‘ì¸ ì¼ë¶€ ë°ì´í„° êµ¬ì¡°ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.</p>
<blockquote>
<p>Package design describes some of the data structures used in QL.</p>
</blockquote>
<h2 id="handles">Handles</h2>
<p>Handleì€ DBì—ì„œ ì‚¬ìš©ì¤‘ì¸ ë¸”ë¡ì—ëŒ€í•œ 7 ë°”ì´íŠ¸ â€œpointerâ€ ì…ë‹ˆë‹¤. <a href="http://godoc.org/github.com/cznic/lldb#hdr-Block_handles"><code>lldb/hdr-Block_handles</code></a></p>
<blockquote>
<p>A handle is a 7 byte &ldquo;pointer&rdquo; to a block in the DB <a href="http://godoc.org/github.com/cznic/lldb#hdr-Block_handles">0</a>.</p>
</blockquote>
<h2 id="scalar-encoding">Scalar encoding</h2>
<p><a href="http://godoc.org/github.com/cznic/lldb#EncodeScalars"><code>lldb/EncodeScalars</code></a>ì—ì„œ ì œê³µí•˜ëŠ” &ldquo;scalars&rdquo; ì¸ì½”ë”©ì„ ë§í•©ë‹ˆë‹¤. ë‹¬ë¦¬ ëª…ì‹œí•˜ì§€ ì•ŠëŠ”í•œ ì•„ë˜ ì„¤ëª…ëœ ëª¨ë“  ê°’ì€ scalars, ì¸ì½”ë”©ëœ scalars, scalar ë°°ì—´ì— ëŒ€í•œ ì¸ì½”ë”© ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>Encoding of so called &ldquo;scalars&rdquo; provided by <a href="http://godoc.org/github.com/cznic/lldb#EncodeScalars"><code>lldb/EncodeScalars</code></a>. Unless specified otherwise, all values discussed below are scalars, encoded scalars or encoding of scalar arrays.</p>
</blockquote>
<h2 id="database-root">Database root</h2>
<p>DB rootëŠ” ê³ ì •ëœ í•¸ë“¤ì—ì„œ ë°œê²¬ë˜ëŠ” 1-scalar ì…ë‹ˆë‹¤ (#1).</p>
<blockquote>
<p>DB root is a 1-scalar found at a fixed handle (#1).</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align: center;">#</th>
<th style="text-align: center;">Name</th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">head</td>
<td style="text-align: center;">handle</td>
<td style="text-align: center;">First table meta data</td>
</tr>
</tbody>
</table>
<p>HeadëŠ” ë©”íƒ€ ë°ì´í„° í…Œì´ë¸”ì—ì„œ ì‹±í´ ë§í¬ ëª©ë¡ì˜ ì œëª© í–‰ì…ë‹ˆë‹¤. <code>0</code>ì€ DBì— ì•„ë¬´ëŸ° í…Œì´ë¸”ì´ ì—†ì„ ê²½ìš°ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>
<blockquote>
<p>Head is the head of a single linked list of table of meta data. It&rsquo;s zero if there are no tables in the DB.</p>
</blockquote>
<h2 id="table-meta-data">Table meta data</h2>
<p>í…Œì´ë¸” ë©”íƒ€ ë°ì´í„°ëŠ” 6-scalar ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>Table meta data are a 6-scalar.</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align: center;">#</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: left;">next</td>
<td style="text-align: left;">handle</td>
<td style="text-align: left;">Next table meta data.</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;">scols</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Column defintitions</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;">hhead</td>
<td style="text-align: left;">handle</td>
<td style="text-align: left;">-&gt; head -&gt; first record</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: left;">name</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Table name</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: left;">indices</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Index definitions</td>
</tr>
<tr>
<td style="text-align: center;">5</td>
<td style="text-align: left;">hxroots</td>
<td style="text-align: left;">handle</td>
<td style="text-align: left;">Index B+Trees roots list</td>
</tr>
</tbody>
</table>
<p>í•„ë“œ #4ì™€ #5ëŠ” ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ì™€ í•˜ìœ„ í˜¸í™˜ì„± (backward compatibility)ì„ ìœ„í•œ ì„ íƒ ì‚¬í•­ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ìƒìœ„ í˜¸í™˜ì„±(forward compatibility)ì€ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìµœì‹  QL ë²„ì „ì—ì„œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ë©”íƒ€ ë°ì´í„°ì— 4ê°€ì§€ í•„ë“œë§Œ ìˆì„ ê²½ìš°, ì´ DBë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ì „ ë²„ì „ QL ì¸ë±ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ì—†ê¸°ì— ë§¤ë²ˆ <code>table-with-indeces</code> ë³€í™”ê°€ ë ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ QL ë²„ì „ ì¿¼ë¦¬ê°€ ì‹¤í–‰ì´ ì•ˆë  ìˆ˜ ìˆì–´ ì˜ë„ëœ êµ¬í˜„ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>Fields #4 and #5 are optional for backward compatibility with existing databases. OTOH, forward compatibility will not work. Once any indices are created using a newer QL version the older versions of QL, expecting only 4 fields of meta data will not be able to use the DB. That&rsquo;s the intended behavior because the older versions of QL cannot update the indexes, which can break queries runned by the newer QL version which expect indices to be always actualized on any table-with-indices mutation.</p>
</blockquote>
<p>ë‹¤ìŒ í…Œì´ë¸” ë©”íƒ€ ë°ì´í„°ì˜ handleì€ í•„ë“œ #0 (<code>next</code>)ì— ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ë‹¤ìŒ í…Œì´ë¸” ë©”íƒ€ ë°ì´í„°ê°€ ì—†ë‹¤ë©´, ì´ í•„ë“œ ê°’ì€ <code>0</code>ì…ë‹ˆë‹¤. í…Œì´ë¸” ì»¬ëŸ¼ì—ëŒ€í•œ ì´ë¦„ê³¼ íƒ€ì…ì€ í•„ë“œ #1 (<code>scols</code>)ì— ìˆìŠµë‹ˆë‹¤. ë‹¨ì¼ í•„ë“œëŠ” íƒ€ì… íƒœê·¸ì™€ ì»¬ëŸ¼ ì´ë¦„ì„ ì—°ê²°í•˜ì—¬ ì„¤ëª…í•©ë‹ˆë‹¤. íƒ€ì… íƒœê·¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>The handle of the next table meta data is in the field #0 (next). If there is no next table meta data, the field is zero. Names and types of table columns are stored in field #1 (scols). A single field is described by concatenating a type tag and the column name. The type tags are</p>
</blockquote>
<div class="highlight"><pre><span></span><code>bool       &#39;b&#39;
complex64  &#39;c&#39;
complex128 &#39;d&#39;
float32    &#39;f&#39;
float64    &#39;g&#39;, alias float
int8       &#39;i&#39;
int16      &#39;j&#39;
int32      &#39;k&#39;
int64      &#39;l&#39;, alias int
string     &#39;s&#39;
uint8      &#39;u&#39;, alias byte
uint16     &#39;v&#39;
uint32     &#39;w&#39;
uint64     &#39;x&#39;, alias uint
bigInt     &#39;I&#39;
bigRat     &#39;R&#39;
blob       &#39;B&#39;
duration   &#39;D&#39;
time       &#39;T&#39;
</code></pre></div>

<p>Scols ê°’ì€ ìœ„ì—ì„œ ì„¤ëª…í•œ ì¸ì½”ë”©ëœ í•„ë“œë¥¼ <code>"|"</code>ë¡œ ê²°í•©í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´</p>
<blockquote>
<p>The scols value is the above described encoded fields joined using &ldquo;|&rdquo;. For example</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="n">Foo</span><span class="w"> </span><span class="n">bool</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">Baz</span><span class="w"> </span><span class="nb">float</span><span class="p">);</span>
</code></pre></div>

<p>ì´ ë¬¸êµ¬ëŠ” scolsë¥¼ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸” ë©”íƒ€ ë°ì´í„°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
<blockquote>
<p>This statement adds a table meta data with scols</p>
</blockquote>
<div class="highlight"><pre><span></span><code>&quot;bFool|sBar|gBaz&quot;
</code></pre></div>

<p>í…Œì´ë¸”ì—ì„œ ì»¬ëŸ¼ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>Columns can be dropped from a table</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">Bar</span><span class="p">;</span>
</code></pre></div>

<p>ì´ë ‡ê²Œ í•˜ë©´ scolsì—ì„œ í•„ë“œ ì •ë³´ê°€ <strong>ì§€ì›Œ</strong>ì§‘ë‹ˆë‹¤. ê°’ì€ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì—¬ì§‘ë‹ˆë‹¤.</p>
<blockquote>
<p>This &ldquo;erases&rdquo; the field info in scols, so the value becomes</p>
</blockquote>
<div class="highlight"><pre><span></span><code>&quot;bFool||gBaz&quot;
</code></pre></div>

<p>í…Œì´ë¸”ì— ì»¤ëŸ¼ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
Colums can be added to a table</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">Count</span><span class="w"> </span><span class="n">uint</span><span class="p">;</span>
</code></pre></div>

<p>ìƒˆë¡œìš´ í•„ë“œëŠ” scols ë§¨ ëì— í•­ìƒ ì¶”ê°€ë©ë‹ˆë‹¤.</p>
<blockquote>
<p>New fields are always added to the end of scols</p>
</blockquote>
<div class="highlight"><pre><span></span><code>â€bFool||gBaz|xCount&quot;
</code></pre></div>

<p><code>strings.Split(scols, "|")</code>ì— ìˆëŠ” í•„ë“œì— ëŒ€í•œ ì¸ë±ìŠ¤ëŠ” í…Œì´ë¸” ë ˆì½”ë“œì— ìˆëŠ” í•„ë“œì— ëŒ€í•œ ì¸ë±ìŠ¤ ì…ë‹ˆë‹¤. ìœ„ì—ì„œ ì„¤ëª…í•œ ì»¬ëŸ¼ ì‚­ì œ ë° ì¶”ê°€ ê·œì¹™ì€ ê¸°ì¡´ í…Œì´ë¸” ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë§Œë“¤ í•„ìš”ì—†ì´ ìŠ¤í‚¤ë§ˆë¥¼ ë³€ê²½ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚­ì œëœ ì»¬ëŸ¼ì€ ì›ë˜ ìœ„ì¹˜ì— ê·¸ëŒ€ë¡œ ë‘ê³  ìƒˆë¡œìš´ ë ˆì½”ë“œëŠ” í•´ë‹¹ ìœ„ì¹˜ì— <code>nil</code>ì„ ì‚½ì…í•©ë‹ˆë‹¤. ì¸ì½”ë”©ëœ <code>nil</code> ê°’ì€ 1 ë°”ì´íŠ¸ì…ë‹ˆë‹¤. ê¸°ì¡´ ë ˆì½”ë“œì— ì—†ëŠ” ê²½ìš°, ì¶”ê°€ëœ ì—´ì€  <code>nil</code> ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì‚­ì œëœ ì»¬ëŸ¼ì˜ ì˜¤ë²„í•´ë“œê°€ ë¬¸ì œê°€ë˜ê³  í…Œì´ë¸” ë ˆì½”ë“œë¥¼ ì´ë™í•  ì¶©ë¶„í•œ ì‹œê°„/ê³µê°„ê³¼ ë©”ëª¨ë¦¬ê°€ ìˆë‹¤ë©´:</p>
<blockquote>
<p>Index of a field in <code>strings.Split(scols, "|")</code> is the index of the field in a table record. The above discussed rules for column dropping and column adding allow for schema evolution without a need to reshape any existing table data. Dropped columns are left where they are and new records insert <code>nil</code> in their place. The encoded <code>nil</code> is one byte. Added columns, when not present in preexisting records are returned as <code>nil</code> values. If the overhead of dropped columns becomes an issue and there&rsquo;s time/space and memory enough to move the records of a table around:</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="k">BEGIN</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="p">;</span>
<span class="w">  </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">(</span><span class="k">column</span><span class="w"> </span><span class="n">definitions</span><span class="p">);</span>
<span class="w">  </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">old</span><span class="p">;</span>
<span class="w">  </span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">old</span><span class="p">;</span>
<span class="w">  </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">old</span><span class="w"> </span><span class="p">(</span><span class="k">column</span><span class="w"> </span><span class="n">definitions</span><span class="p">);</span>
<span class="w">  </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">old</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">new</span><span class="p">;</span>
<span class="w">  </span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">new</span><span class="p">;</span>
<span class="k">END</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="p">;</span>
</code></pre></div>

<p>ì´ê²ƒì€ ì‹œê°„ì /ê³µê°„ì ìœ¼ë¡œ íš¨ê³¼ì ì´ì§€ ëª»í•˜ë©°, Big Dataì¼ ê²½ìš°, íŠ¸ëœì ì…˜ì´ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ë¦¬ì†ŒìŠ¤ì— ì˜í•´ ì œí•œë˜ê¸°ì— OOM ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ì©Œë©´ ì´ê²ƒì„ ìˆ˜í–‰í•˜ëŠ” ë©”ì†Œë“œë‚˜ QL êµ¬ë¬¸ì„ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.(MySQL OPTIMIZE TABLE êµ¬ë¬¸ ì±„íƒì„ ê³ ë ¤í•´ì•¼í•©ë‹ˆë‹¤)</p>
<blockquote>
<p>This is not very time/space effective and for Big Data it can cause an OOM because transactions are limited by memory resources available to the process. Perhaps a method and/or QL statement to do this in-place should be added (MAYBE consider adopting MySQL&rsquo;s OPTIMIZE TABLE syntax).</p>
</blockquote>
<p>í•„ë“œ #2(<code>hhead</code>)ëŠ” í…Œì´ë¸” ë ˆì½”ë“œì˜ í•´ë“œì— ëŒ€í•œ handle ì…ë‹ˆë‹¤. í…Œì´ë¸” ì²« ë²ˆì§¸ ë ˆì½”ë“œì— ëŒ€í•œ handleì´ ì•„ë‹™ë‹ˆë‹¤. ë”°ë¼ì„œ ë ˆì½”ë“œê°€ ì—†ëŠ” í…Œì´ë¸”ì˜ ê²½ìš°ë¼ë„ í•­ìƒ <code>0</code> ê°’ì„ ê°€ì§€ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ <strong>ì´ì¤‘ í¬ì¸í„°(double pointer</strong> ìŠ¤í‚¤ë§ˆë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” (<code>hhead</code> í¬ì¸íŠ¸ì— ëŒ€í•œ) head ë‹¨ì¼ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ ìƒˆ ë ˆì½”ë“œë¥¼ ì¶”ê°€ (ì—°ê²°) í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>Field #2 (<code>hhead</code>) is a handle to a head of table records, i.e. not a handle to the first record in the table. It is thus always non zero even for a table having no records. The reason for this &ldquo;double pointer&rdquo; schema is to enable adding (linking) a new record by updating a single value of the (<code>hhead</code> pointing to) head.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">tableMeta</span><span class="p">.</span><span class="n">hhead</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">firstTableRecord</span>
</code></pre></div>

<p>í…Œì´ë¸” ì´ë¦„ì€ í•„ë“œ #3 (<code>name</code>)ì— ì €ì¥ë©ë‹ˆë‹¤.</p>
<blockquote>
<p>The table name is stored in field #3 (name).</p>
</blockquote>
<h2 id="indices">Indices</h2>
<p>ì¸ë±ìŠ¤ ì´ë¦„ì€ &lsquo;N&rsquo;, ì¸ë±ìŠ¤ ì»¬ëŸ¼ ì´ë¦„ì€ &lsquo;C&rsquo;ìœ¼ë¡œ ì •í•©ë‹ˆë‹¤. ì´ íŠ¹ì • ì¸ë±ìŠ¤ ì¸ì½”ë”©ì€ <code>&lt;tag&gt;N</code> ë¬¸ìì—´ì…ë‹ˆë‹¤. <code>&lt;tag&gt;</code>ëŠ” ê³ ìœ í•˜ì§€ ì•Šì€ ì¸ë±ìŠ¤ëŠ” <code>n</code>ì´ê³  ê³ ìœ í•œ ì¸ë±ìŠ¤ëŠ” <code>u</code> ì…ë‹ˆë‹¤. ì¸ë±ìŠ¤ <code>id()</code>ì™€ scolsì˜ ë‹¤ë¥¸ ëª¨ë“  ì»¬ëŸ¼ì„ ì¸ë±ì‹± í•  ìˆ˜ ìˆëŠ” ì¸ë±ìŠ¤ì— ëŒ€í•œ ì •ë³´ê¸° ì´ ì¸ë±ìŠ¤ì— ìˆìŠµë‹ˆë‹¤. ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ë˜ì§€ ì•Šì€ ê²½ìš°, ì¸ë±ìŠ¤ ì •ë³´ëŠ” ë¹ˆ ë¬¸ìì—´ì…ë‹ˆë‹¤. ëª¨ë“  ì¸ë±ìŠ¤ì— ëŒ€í•œ ì •ë³´ëŠ” <code>"|"</code> ìœ¼ë¡œ ê²°í•©ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:</p>
<blockquote>
<p>Consider an index named N, indexing column named C. The encoding of this particular index is a string &ldquo;<tag>N&rdquo;. <code>&lt;tag&gt;</code> is a string &ldquo;n&rdquo; for non unique indices and &ldquo;u&rdquo; for unique indices. There is this index information for the index possibly indexing the record id() and for all other columns of scols. Where the column is not indexed, the index info is an empty string. Infos for all indexes are joined with &ldquo;|&rdquo;. For example</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="k">BEGIN</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="p">;</span>
<span class="w">  </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="n">Foo</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="n">bool</span><span class="p">,</span><span class="w"> </span><span class="n">Baz</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
<span class="w">  </span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="n">Baz</span><span class="p">);</span>
<span class="w">  </span><span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="n">Foo</span><span class="p">);</span>
<span class="k">COMMIT</span><span class="p">;</span>
</code></pre></div>

<p>ìœ„ì˜ í•„ë“œ #1ê³¼ #4ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>
<blockquote>
<p>The values of fields #1 and #4 for the above are</p>
</blockquote>
<div class="highlight"><pre><span></span><code>scols: &quot;lFoo|bBar|sBaz&quot;
indices: &quot;|uY||nX&quot;
</code></pre></div>

<p><code>"|"</code> ê°’ì„ ë‚˜ëˆ ì„œ ë³´ìë©´:</p>
<blockquote>
<p>Aligning properly the &ldquo;|&rdquo; split parts</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c">             id    col#0    col#1    col#2</span>
<span class="nb">+----------+----+--------+--------+--------+</span>
<span class="c">|   scols: |    | &quot;lFoo&quot; | &quot;bBar&quot; | &quot;sBaz&quot; |</span>
<span class="nb">+----------+----+--------+--------+--------+</span>
<span class="c">| indices: | &quot;&quot; | &quot;uY&quot;   | &quot;&quot;     | &quot;nX&quot;   |</span>
<span class="nb">+----------+----+--------+--------+--------+</span>
</code></pre></div>

<p><code>Foo</code>ì™€ <code>Baz</code> ì»¬ëŸ¼ì´ ì¸ë±ìŠ¤ë˜ëŠ” ë™ì•ˆ ë ˆì½”ë“œ <code>id()</code>ê°€ ì´í…Œì´ë¸”ì— ëŒ€í•´ ì¸ë±ì‹±ë˜ì§€ ì•ŠëŠ” ê²ƒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
<blockquote>
<p>shows that the record id() is not indexed for this table while the columns Foo and Baz are.</p>
</blockquote>
<p>ì£¼ì˜: ë™ì¼í•œ ì»¬ëŸ¼ì— ë‘ê°œì˜ ë‹¤ë¥¸ ì´ë¦„ì„ ê°€ì§„ ì¸ë±ìŠ¤ê°€ ìˆì„ ìˆ˜ ì—†ìœ¼ë©°, ì´ê²ƒì€ ì˜ë„í•œ ê²ƒì…ë‹ˆë‹¤. ì¸ë±ìŠ¤ëŠ” <a href="http://godoc.org/github.com/cznic/lldb#BTree">B+Trees</a>ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë“¤ì˜ ë£¨íŠ¸ì—ì„œ handleì— ëŒ€í•œ ëª©ë¡ì€ ì¸ë±ìŠ¤ê°€ ì—†ëŠ” ì»¬ëŸ¼ì— ëŒ€í•´ì„œ <code>0</code>ê³¼ <code>hxroots</code>ì— ì˜í•´ ê°€ë¦¬ì¼œì§‘ë‹ˆë‹¤. ì´ì „ ì˜ˆì œì˜ ê²½ìš°:</p>
<blockquote>
<p>Note that there cannot be two differently named indexes for the same column and it&rsquo;s intended. The indices are <a href="http://godoc.org/github.com/cznic/lldb#BTree">B+Trees</a>. The list of handles to their roots is pointed to by <code>hxroots</code> with zeros for non indexed columns. For the previous example</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">tableMeta</span><span class="p">.</span><span class="n">hxroots</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">}</span>
</code></pre></div>

<p>ì—¬ê¸°ì„œ <code>x</code>ëŠ” <code>X</code> ì¸ë±ìŠ¤ì˜ B+Treeì— ëŒ€í•œ ë£¨íŠ¸ì´ê³ , <code>y</code>ëŠ” <code>Y</code> ì¸ë±ìŠ¤ì˜ B+Treeì— ëŒ€í•œ ë£¨íŠ¸ì…ë‹ˆë‹¤. <code>id()</code>ì— ëŒ€í•œ ì¸ë±ìŠ¤ê°€ ìˆë‹¤ë©´, ì²«ë²ˆì§¸ <code>0</code>ì´ ìˆëŠ” ê³³ì— B+Tree ë£¨íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤. <code>hhead</code>ì™€ ë§ˆì°¬ê°€ì§€ë¡œ <code>hxroots</code>ëŠ” í…Œì´ë¸”ì— ëŒ€í•œ ì¸ë±ìŠ¤ê°€ ì—†ëŠ” ê²½ìš°ë¼ë„ ì ˆëŒ€ë¡œ <code>0</code>ì´ ì•„ë‹™ë‹ˆë‹¤.</p>
<blockquote>
<p>where x is the root of the B+Tree for the X index and y is the root of the B+Tree for the Y index. If there would be an index for id(), its B+Tree root will be present where the first zero is. Similarly to <code>hhead</code>, <code>hxroots</code> is never zero, even when there are no indices for a table.</p>
</blockquote>
<h2 id="table-record">Table record</h2>
<p>í…Œì´ë¸” ë ˆì½”ë“œëŠ” N-scalar ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>A table record is an N-scalar.</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align: center;">#</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: left;">next</td>
<td style="text-align: left;">handle</td>
<td style="text-align: left;">Next record or zero.</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;">id</td>
<td style="text-align: left;">int64</td>
<td style="text-align: left;">Automatically assigned unique</td>
</tr>
<tr>
<td style="text-align: center;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">value obtainable by id().</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;">field #0</td>
<td style="text-align: left;">scalar</td>
<td style="text-align: left;">First field of the record.</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: left;">field #1</td>
<td style="text-align: left;">scalar</td>
<td style="text-align: left;">Second field of the record.</td>
</tr>
<tr>
<td style="text-align: center;">&hellip;</td>
<td style="text-align: left;">&hellip;</td>
<td style="text-align: left;">&hellip;</td>
<td style="text-align: left;">&hellip;</td>
</tr>
<tr>
<td style="text-align: center;">N-1</td>
<td style="text-align: left;">field #N-2</td>
<td style="text-align: left;">scalar</td>
<td style="text-align: left;">Last field of the record.</td>
</tr>
</tbody>
</table>
<p>í…Œì´ë¸” ë ˆì½”ë„ì— ë§í¬ëœ <strong>ì •ë ¬</strong>ì—ëŠ” ì˜ë¯¸ê°€ ì—†ìœ¼ë¯€ë¡œ ë ˆì½”ë“œê°€ í…Œì´ë¸”ì— ì¶”ê°€ë˜ëŠ” ìˆœì„œì™€ ìƒê´€ì´ ì—†ìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ íš¨ìœ¨ì ì¸ ì—°ê²° ë°©ë²•ì€ <strong>ì •ë ¬</strong>ì„ ìœ ë„í•˜ë©°, ì¶”ê°€ëœ ìˆœì„œì— ê´€í•´ì„œëŠ” ì‹¤ì§€ë¡œ ì—­ìˆœì´ ë©ë‹ˆë‹¤.</p>
<blockquote>
<p>The linked &ldquo;ordering&rdquo; of table records has no semantics and it doesn&rsquo;t have to correlate to the order of how the records were added to the table. In fact, an efficient way of the linking leads to &ldquo;ordering&rdquo; which is actually reversed wrt the insertion order.</p>
</blockquote>
<h2 id="non-unique-index">Non unique index</h2>
<p>B+Treeì— ëŒ€í•œ <a href="https://en.wikipedia.org/wiki/Compound_key">ë³µí•©í‚¤</a>ëŠ” <code>{indexed valuse, record handle}</code> ì…ë‹ˆë‹¤. B+Tree ê°’ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>The composite key of the B+Tree is <code>{indexed values, record handle}</code>. The B+Tree value is not used.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c">            B</span><span class="nb">+</span><span class="c">Tree key                    B</span><span class="nb">+</span><span class="c">Tree value</span>
<span class="nb">+----------------+---------------+</span><span class="c">      </span><span class="nb">+--------------+</span>
<span class="c">| Indexed Values | Record Handle |  </span><span class="nb">-</span><span class="nv">&gt;</span><span class="c">  |   not used   |</span>
<span class="nb">+----------------+---------------+</span><span class="c">      </span><span class="nb">+--------------+</span>
</code></pre></div>

<h2 id="unique-index">Unique index</h2>
<p>ì¸ë±ìŠ¤ëœ ê°’ì´ ëª¨ë‘ <code>NULL</code>ì´ë¼ë©´, ë³µí•© B+Tree í‚¤ëŠ” <code>{nil, record handle}</code>ì´ê³  B+Tree ê°’ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>If the indexed values are all NULL then the composite B+Tree key is <code>{nil, record handle}</code> and the B+Tree value is not used.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c">        B</span><span class="nb">+</span><span class="c">Tree key                B</span><span class="nb">+</span><span class="c">Tree value</span>
<span class="nb">+------+-----------------+</span><span class="c">      </span><span class="nb">+--------------+</span>
<span class="c">| NULL |  Record Handle  |  </span><span class="nb">-</span><span class="nv">&gt;</span><span class="c">  |   not used   |</span>
<span class="nb">+------+-----------------+</span><span class="c">      </span><span class="nb">+--------------+</span>
</code></pre></div>

<p>ì¸ë±ìŠ¤ëœ ê°’ì´ ëª¨ë‘ <code>NULL</code>ì´ë¼ë©´, B+Tree í‚¤ì— ëŒ€í•œ í‚¤ê°€ ì¸ë•ì‹±ëœ ê°’ì´ê³ , B+Tree ê°’ì€ ë ˆì½”ë“œ handle ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>If the indexed values are not all NULL then key of the B+Tree key are the indexed values and the B+Tree value is the record handle.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c">    B</span><span class="nb">+</span><span class="c">Tree key                B</span><span class="nb">+</span><span class="c">Tree value</span>
<span class="nb">+----------------+</span><span class="c">      </span><span class="nb">+---------------+</span>
<span class="c">| Indexed Values |  </span><span class="nb">-</span><span class="nv">&gt;</span><span class="c">  | Record Handle |</span>
<span class="nb">+----------------+</span><span class="c">      </span><span class="nb">+---------------+</span>
</code></pre></div>

<h2 id="non-scalar-types">Non scalar types</h2>
<p><a href="http://godoc.org/github.com/cznic/lldb#EncodeScalars"><code>lldb/EncodeScalars</code></a>ì— ëŒ€í•œ scalar íƒ€ì…ì€ <code>bool</code>, <code>complex*</code>, <code>float*</code>, <code>int*</code>, <code>uint*</code>, <code>string</code>, <code>[]byte</code> íƒ€ì…ì…ë‹ˆë‹¤. ëª¨ë“  ë‹¤ë¥¸ íƒ€ì…ì€ <code>blob-like</code> ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>Scalar types of <a href="http://godoc.org/github.com/cznic/lldb#EncodeScalars"><code>lldb/EncodeScalars</code></a> are <code>bool</code>, <code>complex*</code>, <code>float*</code>, <code>int*</code>, <code>uint*</code>, <code>string</code> and <code>[]byte</code> types. All other types are &ldquo;blob-like&rdquo;.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nx">QL</span><span class="w"> </span><span class="k">type</span><span class="w">         </span><span class="nx">Go</span><span class="w"> </span><span class="k">type</span>
<span class="o">-----------------------------</span>
<span class="nx">blob</span><span class="w">            </span><span class="p">[]</span><span class="nx">byte</span>
<span class="nx">bigint</span><span class="w">          </span><span class="nx">big</span><span class="p">.</span><span class="nx">Int</span>
<span class="nx">bigrat</span><span class="w">          </span><span class="nx">big</span><span class="p">.</span><span class="nx">Rat</span>
<span class="nx">time</span><span class="w">            </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
<span class="nx">duration</span><span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
</code></pre></div>

<p>ë©”ëª¨ë¦¬ ë°±ì—”ë“œëŠ” Go íƒ€ì…ìœ¼ë¡œ ì§ì ‘ ì €ì¥í•©ë‹ˆë‹¤. íŒŒì¼ ë°±ì—”ë“œëŠ” lldbê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì›í•˜ëŠ” ìœ í˜•ì´ ë” ì ê¸°ì— (íƒœê·¸ê°€ ë¶™ì€) <code>[]byte</code>ë¥¼ ì´ìš©í•˜ì—¬ ìœ„ ëª¨ë“  ë‚´ìš©ì„ ì¸ì½”ë”© í•´ì•¼í•©ë‹ˆë‹¤. <code>Blob-like</code>í•œ íƒ€ì…ì˜ <code>NULL</code> ê°’ì€ <code>nil</code> (<code>lldb/db.go</code>ì•ˆì˜ <code>gbNull</code>)ìœ¼ë¡œ ì¸ì½”ë”© ë©ë‹ˆë‹¤. ì´ë¯¸ ì¡´ì¬í•˜ëŠ” QL íƒ€ì…ê³¼ ì™„ì „íˆ ë™ì¼í•©ë‹ˆë‹¤.</p>
<blockquote>
<p>Memory back-end stores the Go type directly. File back-end must resort to encode all of the above as (tagged) <code>[]byte</code> due to the lack of more types supported natively by lldb. NULL values of blob-like types are encoded as <code>nil</code> (<code>gbNull</code> in <code>lldb/gb.go</code>), exactly the same as the already existing QL types are.</p>
</blockquote>
<h2 id="blob-encoding">Blob encoding</h2>
<p><code>Blob-like</code>í•œ íƒ€ì… ê°’ì€ ë¨¼ì € <code>[]byte</code> ìŠ¬ë¼ì´ìŠ¤ë¡œ ì¸ì½”ë”© ë©ë‹ˆë‹¤:</p>
<blockquote>
<p>The values of the blob-like types are first encoded into a <code>[]byte</code> slice:</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nb">+-----------------------+-------------------+</span>
<span class="c">| blob                  | raw               |</span>
<span class="c">| bigint</span><span class="nt">,</span><span class="c"> bigrat</span><span class="nt">,</span><span class="c"> time  | gob encoded       |</span>
<span class="c">| duration              | gob encoded int64 |</span>
<span class="nb">+-----------------------+-------------------+</span>
</code></pre></div>

<p><code>gob</code> ì¸ì½”ë”©ì€ <code>blob-like</code>í•œ íƒ€ì…ì— ëŒ€í•œ ëª¨ë“  ì´ˆê¸° ì¸ì½”ë”©ê³¼ ê´€ë ¨í•˜ì—¬ <strong>ì°¨ë³„ë©ë‹ˆë‹¤</strong>. ë‹¤ë¥¸ ë§ë¡œ, <code>gob</code> ì¸ì½”ë”©ì´ ë°˜ë“œì‹œ ì¨ì•¼ë˜ëŠ” ì´ˆê¸° íƒ€ì… ë””ìŠ¤í¬ë¦½í„°ëŠ” ì œê±°ë˜ê³  ì •ì§í•˜ê²Œ ë””ì½”ë”©ë ë•Œ <strong>ì¬ ê³µê¸‰</strong>ë©ë‹ˆë‹¤. (ì°¸ì¡°, <a href="https://github.com/cznic/ql/blob/v1.1.0/blob.go"><code>blob.go</code></a>). ê²°ê³¼ë¡œ ë‚˜ì˜¨ ìŠ¬ë¼ì´ìŠ¤ ê¸¸ì´ê°€ <code>&lt;= shortBolob</code> ì¸ ê²½ìš°, ì²«ë²ˆì§¸ì´ì ìœ ì¼í•œ ì²­í¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìŠ¤ì¹¼ë¼ ì¸ì½”ë”©ì…ë‹ˆë‹¤:</p>
<blockquote>
<p>The gob encoding is &ldquo;differential&rdquo; wrt an initial encoding of all of the blob-like type. IOW, the initial type descriptors which gob encoding must write out are stripped off and &ldquo;resupplied&rdquo; on decoding transparently. See also blob.go. If the length of the resulting slice is <code>&lt;= shortBlob</code>, the first and only chunk is the scalar encoding of</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">typeTag</span><span class="p">,</span><span class="w"> </span><span class="nx">slice</span><span class="p">}.</span><span class="w">                  </span><span class="c1">// initial (and last) chunk</span>
</code></pre></div>

<p>ìŠ¬ë¼ì´ìŠ¤ ê¸¸ì´ê°€ <code>0</code>ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤ (<code>blob("")</code>ì¸ ê²½ìš°). ê²°ê³¼ë¡œ ë‚˜ì˜¨ ìŠ¬ë¼ì´ìŠ¤ ê¸¸ì´ê°€ ê¸¸ë‹¤ë©´ (<code>&gt; shortBlob</code>), ì²« ë²ˆì§¸ ì²­í¬ëŠ” ì¸ì½”ë”©ì—ì„œ ì˜µë‹ˆë‹¤:</p>
<blockquote>
<p>The length of slice can be zero (for blob(&ldquo;&rdquo;)). If the resulting slice is long (<code>&gt; shortBlob</code>), the first chunk comes from encoding</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">typeTag</span><span class="p">,</span><span class="w"> </span><span class="nx">nextHandle</span><span class="p">,</span><span class="w"> </span><span class="nx">firstPart</span><span class="p">}.</span><span class="w">  </span><span class="c1">// initial, but not final chunk</span>
</code></pre></div>

<p>ì´ ê²½ìš° <code>len(firstPart) &lt;= shortBlob</code>ì…ë‹ˆë‹¤. ë‘ë²ˆì§¸ì™€ ë‹¤ë¥¸ ì²­í¬ì…ë‹ˆë‹¤. ë§Œì•½ ë§ˆì§€ë§‰ ì²­í¬ë©´ <code>src</code>ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>In this case <code>len(firstPart) &lt;= shortBlob</code>. Second and other chunks: If the chunk is the last one, src is</p>
</blockquote>
<div class="highlight"><pre><span></span><code>[]interface{lastPart}.                          // overflow chunk (last)
</code></pre></div>

<p>ì´ ê²½ìš° <code>len(lastPart) &lt;= 64kB</code>ì…ë‹ˆë‹¤. ë§ˆì§€ë§‰ ì²­í¬ê°€ ì•„ë‹Œ ê²½ìš°, <code>src</code>ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>In this case <code>len(lastPart) &lt;= 64kB</code>. If the chunk is not the last one, src is</p>
</blockquote>
<div class="highlight"><pre><span></span><code>[]interface{}{nextHandle, part}.                // overflow chunk (not last)
</code></pre></div>

<p>ì´ ê²½ìš°ëŠ” <code>len(part) == 64kB</code> ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>In this case <code>len(part) == 64kB</code>.</p>
</blockquote>
<h2 id="links">Links</h2>
<p>ì°¸ì¡° ì‚¬í•­:</p>
<blockquote>
<p>Referenced from above:</p>
</blockquote>
<div class="highlight"><pre><span></span><code>[0]: http://godoc.org/github.com/cznic/lldb#hdr-Block_handles
[1]: http://godoc.org/github.com/cznic/lldb#EncodeScalars
[2]: http://godoc.org/github.com/cznic/lldb#BTree
</code></pre></div>

<h2 id="rationale">Rationale</h2>
<p>ì´ ë…¸íŠ¸ëŠ” QL ì†ŒìŠ¤ë¥¼ ë³´ë“  ì‚¬ëŒì—ê²Œ ìœ ìš© í•  ìˆ˜ ìˆì§€ë§Œ, íŠ¹ë³„íˆ ì˜ë„ëœ ë…ìëŠ” ë¯¸ë˜ì˜ ë‚˜ ìì‹ ì…ë‹ˆë‹¤.</p>
<blockquote>
<p>While these notes might be useful to anyone looking at QL sources, the specifically intended reader is my future self.</p>
</blockquote></div>
    <div class="text-center"><em class="fa-regular fa-hand-spock"></em></div>

  <!-- Buy me a coffee -->
    <div class="text-center">
<div>
  <a href="https://www.buymeacoffee.com/8967ktT" target="_blank">
    <img src="https://cdn.buymeacoffee.com/buttons/default-black.png"
       alt="Buy Me A Coffee"
       style="width:15%">
  </a>
</div>    </div>

  <!-- Comment -->
<div id="giscus">
<script src="https://giscus.app/client.js"
  data-repo="ujuc/ujuc.github.io"
  data-repo-id="MDEwOlJlcG9zaXRvcnkzMzA2MTA2NQ=="
  data-category="General"
  data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDM5MjEy"
  data-mapping="title"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-theme="light"
  crossorigin="anonymous"
  async>
</script>
</div><div id="utterances">
  <script src="https://utteranc.es/client.js"
    repo="ujuc/ujuc.github.io"
    issue-term="url"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</div>    <div class="text-center">ğŸ—</div>
  </div>
</div>
    </div>

    <!-- body foot -->
    <div class="container">
    </div>

    <!-- Title -->
    <div id="site-title" class="container">
      <hr/>
<div class="row">
  <div class="container">
  <div class="site-title">
    <a href="https://ujuc.github.io">ì˜ ë°¤ì— ì“¸ë°ì—†ëŠ” ìƒê°í•˜ê¸°</a>
  </div>
  <div class="site-body">
    Anythink, Everythink!
  </div>
  <div>
    <span id="social-github"><a href="https://github.com/ujuc"><em class="fa-brands fa-github"></em></a></span>
    <span id="social-linkin"><a href="https://kr.linkedin.com/in/sungjinkang"><em class="fa-brands fa-linkedin"></em></a></span>
    <span id="social-x"><a href="https://x.com/ujuc"><em class="fa-brands fa-x-twitter"></em></a></span>
  </div>
  </div>
</div>    </div>

    <!-- Footer -->
    <div id="site-footer" class="container">
<div class="row text-right">
  <div class="container" style="margin-bottom: 10px;">
    <em class="fa-regular fa-closed-captioning"></em> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">BY-SA</a> 2012-2024 ujuc. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>.
  </div>
</div>    </div>

    <!-- Javascript -->
<!--bootstrap-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>    <div id="js" class="contents">
    </div>
  </body>
</html>
<!DOCTYPE html>
<html lang="ko">

  <head>
    <!-- Meta -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="ujuc">
    
    <meta property="og:site_name" content="잘 밤에 쓸데없는 생각하기...">
    <meta property="og:type" content="website">
    <meta property="inLanguage" content="ko-KR">

    <!-- Twitter Card data-->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="잘 밤에 쓸데없는 생각하기...">

    <meta name="keyward" content="docker,compose,config file">
    <meta property="og:title" content="docker-compose Extension fields 알아보기">
    <meta name="twitter:title" content="docker-compose Extension fields 알아보기">
    <meta itemprop="name" content="docker-compose Extension fields 알아보기">
    <meta name="description" content="docker-compose 파일에서 새로운 문구를 발견했다. 정리나 하자.">
    <meta property="og:description" content="docker-compose 파일에서 새로운 문구를 발견했다. 정리나 하자.">
    <meta name="twitter:description" content="docker-compose 파일에서 새로운 문구를 발견했다. 정리나 하자.">
    <meta itemprop="description" content="docker-compose 파일에서 새로운 문구를 발견했다. 정리나 하자.">
    <meta property="og:url" content="https://ujuc.github.io/2021/07/15/docker-compose-extension-fields-알아보기/">
    <meta property="article:published_time" content="2021-07-15T15:53:42+09:00">
    <meta property="article:modified_time" content="2021-07-15T15:53:42+09:00">
    <meta property="article:tag" content="docker">
    <meta property="article:tag" content="compose">
    <meta property="article:tag" content="config file">
    

    <!-- Title -->
    <title>
      잘 밤에 쓸데없는 생각하기.../docker-compose Extension fields 알아보기
    </title>

<!-- Style sheet -->
<!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/44208652df.js" crossorigin="anonymous"></script>

<!-- Style -->
<link rel="stylesheet" type="text/css" href="https://ujuc.github.io/theme/css/style.css">
<link rel="stylesheet" type="text/css" href="https://ujuc.github.io/theme/css/pygments.css">

<!-- Feed -->
  <link href="https://ujuc.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="잘 밤에 쓸데없는 생각하기... ATOM" />
  <link href="https://ujuc.github.io/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="잘 밤에 쓸데없는 생각하기... RSS" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-58634276-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-58634276-1');
  </script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-1014314833699403",
      enable_page_level_ads: true
    });
  </script>
  </head>

  <body>
  <header>
    <!-- navi -->
    <div class="container" style="margin-top: 10px;">
<ul class="nav">
    <li class="nav-item">
      <a class="nav-link" href="/">
        <em class="fa-solid fa-inbox"></em> Blog
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/archives.html">
        <em class="fa-solid fa-archive"></em> Archive
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/tags.html">
        <em class="fa-solid fa-tags"></em> Tags
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/categories.html">
        <em class="fa-solid fa-folder-open"></em> Categories
      </a>
    </li>
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
        <em class="fa-solid fa-newspaper"></em> Pages
      </a>
      <div class="dropdown-menu">
      </div>
    </li>
</ul>    </div>
  </header>

  <div id="site_article" class="container">
    <div class="container">
      <div class="article">
        <div class="article_title">docker-compose Extension fields 알아보기</div>
        <div class="article_meta">
          <em class="fa-regular fa-calendar-plus"></em>
            21. 07. 15.
 / <em class="fa-solid fa-arrows-rotate"></em> 21. 07. 15.           <em class="fa-solid fa-ellipsis-vertical"></em>
          <em class="fa-solid fa-folder-open"></em> 
            <a href="https://ujuc.github.io/category/operation.html">Operation</a>
          <em class="fa-solid fa-ellipsis-vertical"></em>
          <em class="fa-solid fa-tags"></em>
            <a href="https://ujuc.github.io/tag/docker.html" class="article_tag">docker</a>
            <a href="https://ujuc.github.io/tag/compose.html" class="article_tag">compose</a>
            <a href="https://ujuc.github.io/tag/config-file.html" class="article_tag">config file</a>
          </i>
        </div>
        <div class="text-center"><em class="fa-solid fa-poo-storm"></em></div>
        <div class="article_text"><p>Airflow를 볼까해서 docker-compose 파일을 받아서 봤는데&hellip; 뭔가 새로운 문구가 발견되었다.<br>
다음과같은 부분임.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span><span class="w"></span>
<span class="nt">x-airflow-common</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nl">&amp;airflow-common</span><span class="w"></span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${AIRFLOW_IMAGE_NAME:-apache/airflow:2.1.2}</span><span class="w"></span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nl">&amp;airflow-common-env</span><span class="w"></span>
<span class="w">    </span><span class="nt">AIRFLOW__CORE__EXECUTOR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CeleryExecutor</span><span class="w"></span>
<span class="w">    </span><span class="nt">AIRFLOW__CORE__SQL_ALCHEMY_CONN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql+psycopg2://airflow:airflow@postgres/airflow</span><span class="w"></span>
<span class="w">    </span><span class="nt">AIRFLOW__CELERY__RESULT_BACKEND</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db+postgresql://airflow:airflow@postgres/airflow</span><span class="w"></span>
<span class="w">    </span><span class="nt">AIRFLOW__CELERY__BROKER_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis://:@redis:6379/0</span><span class="w"></span>
<span class="w">    </span><span class="nt">AIRFLOW__CORE__FERNET_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">AIRFLOW__CORE__LOAD_EXAMPLES</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">AIRFLOW__API__AUTH_BACKEND</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;airflow.api.auth.backend.basic_auth&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">_PIP_ADDITIONAL_REQUIREMENTS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${_PIP_ADDITIONAL_REQUIREMENTS:-}</span><span class="w"></span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./dags:/opt/airflow/dags</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/opt/airflow/logs</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./plugins:/opt/airflow/plugins</span><span class="w"></span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${AIRFLOW_UID:-50000}:${AIRFLOW_GID:-50000}&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">redis</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span><span class="w"></span>
<span class="w">    </span><span class="nt">postgres</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="nn">...</span><span class="w"></span>
<span class="w">  </span><span class="nt">airflow-init</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*airflow-common</span><span class="w"></span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">version</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*airflow-common-env</span><span class="w"></span>
<span class="w">      </span><span class="nt">_AIRFLOW_DB_UPGRADE</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">_AIRFLOW_WWW_USER_CREATE</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span><span class="w"></span>
<span class="w">      </span><span class="nt">_AIRFLOW_WWW_USER_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${_AIRFLOW_WWW_USER_USERNAME:-airflow}</span><span class="w"></span>
<span class="w">      </span><span class="nt">_AIRFLOW_WWW_USER_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${_AIRFLOW_WWW_USER_PASSWORD:-airflow}</span><span class="w"></span>

<span class="nn">...</span><span class="w"></span>
</code></pre></div>

<p>보면 알겠지만 분명 version 3버전인데 <code>&amp;</code>, <code>*</code> 를 이용해서 이미지와 환경설정 구문을 반복해서 사용할 수 있도록 구성해놓은 것으로 판단되고 있다.<br>
그래서 문서를 찾다보니 맨밑에&hellip; <code>Extension fields</code> 라고 되어있는 부분이 존재한다. 문서를 끝까지 안봐서 몰랐던듯.</p>
<p>뭔가 써봤으면 알것는데. 이번기회에 정리하고 사용해봐야할듯. 메뉴얼 문서 번역이 될듯함.</p>
<p>추가로 YAML 스팩을 봐야할듯. YAML 스팩에 있는 내용을 그대로 사용할 수 있다고 해놓은걸보니&hellip; YAML에 대한 내용을 제대로 안다면 쉽게 구성할 수 있을 것으로 보여진다.</p>
<hr>
<h2 id="extension-fields">Extension fields</h2>
<ul>
<li><a href="https://docs.docker.com/compose/compose-file/compose-file-v3/#extension-fields">공식 문서</a></li>
</ul>
<blockquote>
<p>버전 3.4에 추가됨</p>
</blockquote>
<p>확장 필드를 사용해 구성 조각을 재 사용할 수 있습니다. 이 부분은 compose 파일에서 루트 위치에 존재하고 키이름에 접두사로 <code>x-</code>를 사용하여 표시합니다.</p>
<blockquote>
<p>Note: 포멧 버전 3.7과 2.4에서는 <code>service</code>, <code>volume</code>, <code>network</code>, <code>config</code>, <code>secret</code> 정의시 사용이 가능합니다.</p>
</blockquote>
<p>다음과 같이 YAML anchor 기능을 통해서 리소스 정의에 삽입이 가능합니다.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.9&quot;</span><span class="w"></span>
<span class="nt">x-logging</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nl">&amp;default-logging</span><span class="w"></span>
<span class="w">  </span><span class="nt">options</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;12m&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;5&#39;</span><span class="w"></span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">web</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp/web:latest</span><span class="w"></span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-logging</span><span class="w"></span>
<span class="w">  </span><span class="nt">db</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:latest</span><span class="w"></span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-logging</span><span class="w"></span>
</code></pre></div>

<p>YAML 머지 형식을 이용하여 원하는 값을 추가할 수 있습니다.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.9&quot;</span><span class="w"></span>
<span class="nt">x-volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nl">&amp;default-volume</span><span class="w"></span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foobar-storage</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">web</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp/web:latest</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;vol1&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;vol2&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;vol3&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">vol1</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-volume</span><span class="w"></span>
<span class="w">  </span><span class="nt">vol2</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">&lt;&lt; </span><span class="p">:</span><span class="w"> </span><span class="nv">*default-volume</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volume02</span><span class="w"></span>
<span class="w">  </span><span class="nt">vol3</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">&lt;&lt; </span><span class="p">:</span><span class="w"> </span><span class="nv">*default-volume</span><span class="w"></span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volume-local</span><span class="w"></span>
</code></pre></div></div>
        <div class="text-center"><em class="fa-regular fa-hand-spock"></em></div>

        <!-- Buy me a coffee -->
        <div class="text-center">
<p>
  <a href="https://www.buymeacoffee.com/8967ktT" target="_blank">
    <img src="https://cdn.buymeacoffee.com/buttons/default-black.png"
         alt="Buy Me A Coffee"
         style="width:15%"
    >
  </a>
</p>        </div>

        <!-- Comment -->
<div id="giscus">
    <script src="https://giscus.app/client.js"
        data-repo="ujuc/ujuc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMzA2MTA2NQ=="
        data-category="General"
        data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDM5MjEy"
        data-mapping="title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        crossorigin="anonymous"
        async>
</script>
</div><div id="utterances">
    <script src="https://utteranc.es/client.js"
            repo="ujuc/ujuc.github.io"
            issue-term="url"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
</div>        <div class="text-center">🎗</div>
      </div>
    </div>
  </div>

  <!-- body foot -->
  <div class="container">
  </div>

  <!-- Title -->
  <div id="site_title" class="container">
<div class="row">
  <div class="container">
    <hr />
    <p><a href="https://ujuc.github.io" class="article_title">잘 밤에 쓸데없는 생각하기...</a></p>
    <p>Anythink, Everythink!</p>
    <span id="social-github"><a href="https://github.com/ujuc"><em class="fa-brands fa-github"></em></a></span>
    <span id="social-linkin"><a href="https://kr.linkedin.com/in/sungjinkang"><em class="fa-brands fa-linkedin"></em></a></span>
  </div>
</div>  </div>

  <!-- Footer -->
  <div id="site_footer" class="container">
<div class="row text-right">
  <div class="container" style="margin-bottom: 10px;">
    <em class="fa-regular fa-closed-captioning"></em> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">BY-SA</a> 2012-2022 ujuc. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>.
  </div>
</div>  </div>

  <!-- Javascript -->
<!--bootstrap-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>  <div id="js" class="contents">
  </div>

  </body>
</html>